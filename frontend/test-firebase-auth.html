<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Test</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
</head>
<body>
    <h1>Firebase Auth Test</h1>
    <button onclick="signIn()">Sign in with Google</button>
    <button onclick="testBackend()">Test Backend</button>
    <pre id="output"></pre>

    <script>
        // Firebase configuration from frontend .env
        const firebaseConfig = {
            apiKey: "AIzaSyCKqdRdWPX947HPRa5D-KzQNroi8GQ-WDk",
            authDomain: "formbuilder-f4460.firebaseapp.com",
            projectId: "formbuilder-f4460",
            messagingSenderId: "194132105959",
            appId: "1:194132105959:web:209b76fb906773a32f2042"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        function log(message) {
            document.getElementById('output').textContent += message + '\n';
        }

        async function signIn() {
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                const idToken = await user.getIdToken();
                
                log('Signed in as: ' + user.email);
                log('ID Token (first 50 chars): ' + idToken.substring(0, 50) + '...');
                log('\nFull token for testing:');
                log(idToken);
                
                // Store token for backend test
                window.currentToken = idToken;
            } catch (error) {
                log('Sign in error: ' + error.message);
            }
        }

        async function testBackend() {
            if (!window.currentToken) {
                log('Please sign in first!');
                return;
            }

            try {
                log('\nTesting backend...');
                const response = await fetch('https://healthcare-forms-backend-yv6dlhmhwa-uc.a.run.app/api/v1/auth/firebase-login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${window.currentToken}`
                    },
                    body: JSON.stringify({})
                });

                const data = await response.text();
                log('Backend response status: ' + response.status);
                log('Backend response: ' + data);
            } catch (error) {
                log('Backend test error: ' + error.message);
            }
        }

        // Check if already signed in
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                log('Already signed in as: ' + user.email);
                const idToken = await user.getIdToken();
                window.currentToken = idToken;
            }
        });
    </script>
</body>
</html>